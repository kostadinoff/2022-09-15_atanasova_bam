filter(is.na(days_to_death) | days_to_death <107)
dat_seq <- read_csv("~/MEGAsync/2022-09-15_atanasova_bam/data.csv",
col_types = cols(birth_date = col_date(format = "%Y-%m-%d"),
admit_day = col_date(format = "%Y-%m-%d"),
disch_day = col_date(format = "%Y-%m-%d"),
death_date = col_date(format = "%Y-%m-%d"))) %>%
mutate(age = calc_age(birth_date, admit_day)) %>%
mutate(days_hospital = calc_days(admit_day,disch_day)) %>%
mutate(days_to_death = calc_days(admit_day, death_date)) %>%
filter(is.na(days_to_death) | days_to_death <108)
dat_seq <- read_csv("~/MEGAsync/2022-09-15_atanasova_bam/data.csv",
col_types = cols(birth_date = col_date(format = "%Y-%m-%d"),
admit_day = col_date(format = "%Y-%m-%d"),
disch_day = col_date(format = "%Y-%m-%d"),
death_date = col_date(format = "%Y-%m-%d"))) %>%
mutate(age = calc_age(birth_date, admit_day)) %>%
mutate(days_hospital = calc_days(admit_day,disch_day)) %>%
mutate(days_to_death = calc_days(admit_day, death_date)) %>%
filter(is.na(days_to_death) | days_to_death <108)
dat_seq <- read_csv("~/MEGAsync/2022-09-15_atanasova_bam/data.csv",
col_types = cols(birth_date = col_date(format = "%Y-%m-%d"),
admit_day = col_date(format = "%Y-%m-%d"),
disch_day = col_date(format = "%Y-%m-%d"),
death_date = col_date(format = "%Y-%m-%d"))) %>%
mutate(age = calc_age(birth_date, admit_day)) %>%
mutate(days_hospital = calc_days(admit_day,disch_day)) %>%
mutate(days_to_death = calc_days(admit_day, death_date))
dat_seq <- read_csv("~/MEGAsync/2022-09-15_atanasova_bam/data.csv",
col_types = cols(birth_date = col_date(format = "%Y-%m-%d"),
admit_day = col_date(format = "%Y-%m-%d"),
disch_day = col_date(format = "%Y-%m-%d"),
death_date = col_date(format = "%Y-%m-%d"))) %>%
mutate(age = calc_age(birth_date, admit_day)) %>%
mutate(days_hospital = calc_days(admit_day,disch_day)) %>%
mutate(days_to_death = calc_days(admit_day, death_date))
dat_seq <- read_csv("~/MEGAsync/2022-09-15_atanasova_bam/data.csv",
col_types = cols(birth_date = col_date(format = "%Y-%m-%d"),
admit_day = col_date(format = "%Y-%m-%d"),
disch_day = col_date(format = "%Y-%m-%d"),
death_date = col_date(format = "%Y-%m-%d"))) %>%
mutate(age = calc_age(birth_date, admit_day)) %>%
mutate(days_hospital = calc_days(admit_day,disch_day)) %>%
mutate(days_to_death = calc_days(admit_day, death_date)) %>%
filter(is.na(days_to_death) | days_to_death <108)
dat_seq <- read_csv("~/MEGAsync/2022-09-15_atanasova_bam/data.csv",
col_types = cols(birth_date = col_date(format = "%Y-%m-%d"),
admit_day = col_date(format = "%Y-%m-%d"),
disch_day = col_date(format = "%Y-%m-%d"),
death_date = col_date(format = "%Y-%m-%d"))) %>%
mutate(age = calc_age(birth_date, admit_day)) %>%
mutate(days_hospital = calc_days(admit_day,disch_day)) %>%
mutate(days_to_death = calc_days(admit_day, death_date)) %>%
mutate(days_to_death = case_when(
days_to_death > 107 ~ NA,
TRUE         ~  "days_to_death"))
dat_seq <- read_csv("~/MEGAsync/2022-09-15_atanasova_bam/data.csv",
col_types = cols(birth_date = col_date(format = "%Y-%m-%d"),
admit_day = col_date(format = "%Y-%m-%d"),
disch_day = col_date(format = "%Y-%m-%d"),
death_date = col_date(format = "%Y-%m-%d"))) %>%
mutate(age = calc_age(birth_date, admit_day)) %>%
mutate(days_hospital = calc_days(admit_day,disch_day)) %>%
mutate(days_to_death = calc_days(admit_day, death_date)) %>%
mutate(days_to_death = case_when(
days_to_death > 107 ~ "NA",
TRUE         ~  "days_to_death"))
View(dat_seq)
View(dat_seq)
dat_seq <- read_csv("~/MEGAsync/2022-09-15_atanasova_bam/data.csv",
col_types = cols(birth_date = col_date(format = "%Y-%m-%d"),
admit_day = col_date(format = "%Y-%m-%d"),
disch_day = col_date(format = "%Y-%m-%d"),
death_date = col_date(format = "%Y-%m-%d"))) %>%
mutate(age = calc_age(birth_date, admit_day)) %>%
mutate(days_hospital = calc_days(admit_day,disch_day)) %>%
mutate(days_to_death = calc_days(admit_day, death_date)) %>%
mutate(days_to_death = case_when(
days_to_death > 107 ~ "NA",
TRUE         ~  days_to_death))
dat_seq <- read_csv("~/MEGAsync/2022-09-15_atanasova_bam/data.csv",
col_types = cols(birth_date = col_date(format = "%Y-%m-%d"),
admit_day = col_date(format = "%Y-%m-%d"),
disch_day = col_date(format = "%Y-%m-%d"),
death_date = col_date(format = "%Y-%m-%d"))) %>%
mutate(age = calc_age(birth_date, admit_day)) %>%
mutate(days_hospital = calc_days(admit_day,disch_day)) %>%
mutate(days_to_death = calc_days(admit_day, death_date)) %>%
mutate(days_to_death = case_when(
days_to_death > 107 ~ "NA",
TRUE         ~  dat_seq$days_to_death))
View(dat_seq)
View(dat_seq)
dat_seq <- read_csv("~/MEGAsync/2022-09-15_atanasova_bam/data.csv",
col_types = cols(birth_date = col_date(format = "%Y-%m-%d"),
admit_day = col_date(format = "%Y-%m-%d"),
disch_day = col_date(format = "%Y-%m-%d"),
death_date = col_date(format = "%Y-%m-%d"))) %>%
mutate(age = calc_age(birth_date, admit_day)) %>%
mutate(days_hospital = calc_days(admit_day,disch_day)) %>%
mutate(days_to_death = calc_days(admit_day, death_date)) %>%
mutate(days_to_death = case_when(
days_to_death > 107 ~ "NA",
TRUE         ~  as_numeric(days_to_death))
View(dat_seq)
View(dat_seq)
dat_seq <- read_csv("~/MEGAsync/2022-09-15_atanasova_bam/data.csv",
col_types = cols(birth_date = col_date(format = "%Y-%m-%d"),
admit_day = col_date(format = "%Y-%m-%d"),
disch_day = col_date(format = "%Y-%m-%d"),
death_date = col_date(format = "%Y-%m-%d"))) %>%
mutate(age = calc_age(birth_date, admit_day)) %>%
mutate(days_hospital = calc_days(admit_day,disch_day)) %>%
mutate(days_to_death = calc_days(admit_day, death_date)) %>%
mutate(days_to_death = case_when(
days_to_death > 107 ~ NA,
TRUE         ~  as_numeric(days_to_death)))
dat_seq <- read_csv("~/MEGAsync/2022-09-15_atanasova_bam/data.csv",
col_types = cols(birth_date = col_date(format = "%Y-%m-%d"),
admit_day = col_date(format = "%Y-%m-%d"),
disch_day = col_date(format = "%Y-%m-%d"),
death_date = col_date(format = "%Y-%m-%d"))) %>%
mutate(age = calc_age(birth_date, admit_day)) %>%
mutate(days_hospital = calc_days(admit_day,disch_day)) %>%
mutate(days_to_death = calc_days(admit_day, death_date)) %>%
mutate(days_to_death = case_when(
days_to_death > 107 ~ NA,
TRUE         ~  as.numeric(days_to_death)))
dat_seq <- read_csv("~/MEGAsync/2022-09-15_atanasova_bam/data.csv",
col_types = cols(birth_date = col_date(format = "%Y-%m-%d"),
admit_day = col_date(format = "%Y-%m-%d"),
disch_day = col_date(format = "%Y-%m-%d"),
death_date = col_date(format = "%Y-%m-%d"))) %>%
mutate(age = calc_age(birth_date, admit_day)) %>%
mutate(days_hospital = calc_days(admit_day,disch_day)) %>%
mutate(days_to_death = calc_days(admit_day, death_date)) %>%
mutate(days_to_death = case_when(
days_to_death > 107 ~ "NA",
TRUE         ~  as.numeric(days_to_death)))
?mutate_if
dat_seq <- read_csv("~/MEGAsync/2022-09-15_atanasova_bam/data.csv",
col_types = cols(birth_date = col_date(format = "%Y-%m-%d"),
admit_day = col_date(format = "%Y-%m-%d"),
disch_day = col_date(format = "%Y-%m-%d"),
death_date = col_date(format = "%Y-%m-%d"))) %>%
mutate(age = calc_age(birth_date, admit_day)) %>%
mutate(days_hospital = calc_days(admit_day,disch_day)) %>%
mutate(days_to_death = calc_days(admit_day, death_date)) %>%
mutate(days_to_death = case_when(days_to_death > 107 ~ NA_real_, TRUE ~ days_to_death))
View(dat_seq)
View(dat_seq)
#| echo: false
dat_all <- read_csv("~/MEGAsync/2022-09-15_atanasova_bam/all_patients.csv",
col_types = cols(birth_date = col_date(format = "%Y-%m-%d"),
admit_day = col_date(format = "%Y-%m-%d"),
disch_day = col_date(format = "%Y-%m-%d"),
death_date = col_date(format = "%Y-%m-%d")))
dat_all = dat_all %>%
select(-c(type, exam_day, date_pcr_results)) %>%
distinct() %>%
mutate(age = calc_age(birth_date, admit_day)) %>%
mutate(days_hospital = calc_days(admit_day,disch_day)) %>%
mutate(days_to_death = calc_days(admit_day, death_date)) %>%
mutate(days_to_death = case_when(days_to_death > 107 ~ NA_real_, TRUE ~ days_to_death))
#| echo: false
dat_all <- read_csv("~/MEGAsync/2022-09-15_atanasova_bam/all_patients.csv",
col_types = cols(birth_date = col_date(format = "%Y-%m-%d"),
admit_day = col_date(format = "%Y-%m-%d"),
disch_day = col_date(format = "%Y-%m-%d"),
death_date = col_date(format = "%Y-%m-%d")))
dat_all = dat_all %>%
select(-c(type, exam_day, date_pcr_results)) %>%
distinct() %>%
mutate(age = calc_age(birth_date, admit_day),
days_hospital = calc_days(admit_day,disch_day),
days_to_death = calc_days(admit_day, death_date)) %>%
mutate(days_to_death = case_when(days_to_death > 107 ~ NA_real_, TRUE ~ days_to_death)) %>%
filter(between(admit_day, as.Date('2021-07-01'), as.Date('2022-05-09')))
dat_seq <- read_csv("~/MEGAsync/2022-09-15_atanasova_bam/data.csv",
col_types = cols(birth_date = col_date(format = "%Y-%m-%d"),
admit_day = col_date(format = "%Y-%m-%d"),
disch_day = col_date(format = "%Y-%m-%d"),
death_date = col_date(format = "%Y-%m-%d"))) %>%
mutate(age = calc_age(birth_date, admit_day),
days_hospital = calc_days(admit_day,disch_day),
days_to_death = calc_days(admit_day, death_date)) %>%
mutate(days_to_death = case_when(days_to_death > 107 ~ NA_real_, TRUE ~ days_to_death))
View(dat_all)
View(dat_all)
dat_seq
#| echo: false
table_1 = dat_seq %>%
select(-c(weeks, week)) %>%
mutate(sempl = "sample",
id = as.character(id)) %>%
left_join(dat_all)
table_1
#| echo: false
table_1 = dat_seq %>%
select(-c(weeks, week)) %>%
mutate(sempl = "sample",
id = as.character(id)) %>%
right_join(dat_all)
table_1
View(table_1)
View(table_1)
#| echo: false
table_1 = dat_seq %>%
select(-c(weeks, week)) %>%
mutate(sempl = "sample",
id = as.character(id)) %>%
right_join(dat_all) %>%
mutate(sampl = case_when(sampl == "NA" ~ "general_pop", TRUE ~ sampl))
#| echo: false
table_1 = dat_seq %>%
select(-c(weeks, week)) %>%
mutate(sempl = "sample",
id = as.character(id)) %>%
right_join(dat_all) %>%
mutate(sempl = case_when(sampl == "NA" ~ "general_pop", TRUE ~ sampl))
#| echo: false
table_1 = dat_seq %>%
select(-c(weeks, week)) %>%
mutate(sempl = "sample",
id = as.character(id)) %>%
right_join(dat_all) %>%
mutate(sempl = case_when(sampl == NA ~ "general_pop", TRUE ~ sampl))
table_1 = dat_seq %>%
select(-c(weeks, week)) %>%
mutate(sempl = "sample",
id = as.character(id)) %>%
right_join(dat_all)
table_1
View(table_1)
View(table_1)
table_1 = dat_seq %>%
select(-c(weeks, week)) %>%
mutate(sempl = "sample",
id = as.character(id)) %>%
right_join(dat_all) %>%
mutate(sempl = if_else(is.na(sempl),"general_pop"))
table_1 = dat_seq %>%
select(-c(weeks, week)) %>%
mutate(sempl = "sample",
id = as.character(id)) %>%
right_join(dat_all) %>%
mutate(sempl = if_else(is.na(sempl),"general_pop","sample"))
View(table_1)
View(table_1)
View(dat_all)
View(dat_all)
#| echo: false
table_1 = dat_seq %>%
select(-c(weeks, week)) %>%
mutate(sempl = "sample",
id = as.character(id)) %>%
right_join(dat_all) %>%
mutate(sempl = if_else(is.na(sempl),"general_pop","sample")) %>%
select(days_hospital,days_to_death,sex,sempl,age) %>%
mutate(male = ifelse(sex == "Мъж",1,0),
days_to_death = as.numeric(days_to_death),
days_hospital = as.numeric(days_hospital)) %>%
select(-sex) %>%
tbl_summary(
by = sempl,
missing = "no"
) %>%
add_difference()
table_1
#| echo: false
table_1 = dat_seq %>%
select(-c(weeks, week)) %>%
mutate(sempl = "sample",
id = as.character(id)) %>%
right_join(dat_all) %>%
mutate(sempl = if_else(is.na(sempl),"general_pop","sample")) %>%
select(days_hospital,days_to_death,sex,sempl,age) %>%
mutate(male = ifelse(sex == "Мъж",1,0),
days_to_death = as.numeric(days_to_death),
days_hospital = as.numeric(days_hospital)) %>%
select(-sex) %>%
tbl_summary(
by = sempl,
statistic = list(all_continuous() ~ "{mean} ({sd})",
all_categorical() ~ "{n} / {N} ({p}%)"),
missing = "no"
) %>%
add_difference()
#| echo: false
table_1 = dat_seq %>%
select(-c(weeks, week)) %>%
mutate(sempl = "sample",
id = as.character(id)) %>%
right_join(dat_all) %>%
mutate(sempl = if_else(is.na(sempl),"general_pop","sample")) %>%
select(days_hospital,days_to_death,sex,sempl,age) %>%
mutate(male = ifelse(sex == "Мъж",1,0),
days_to_death = as.numeric(days_to_death),
days_hospital = as.numeric(days_hospital)) %>%
select(-sex) %>%
tbl_summary(
by = sempl,
statistic = list(all_continuous() ~ "{mean} ({sd})",
all_categorical() ~ "{n} / {N} ({p}%)"),
missing = "no"
) %>%
add_difference()
table_1
table_1 = dat_seq %>%
select(-c(weeks, week)) %>%
mutate(sempl = "sample",
id = as.character(id)) %>%
right_join(dat_all) %>%
mutate(sempl = if_else(is.na(sempl),"general_pop","sample")) %>%
select(days_hospital,days_to_death,sex,sempl,age) %>%
mutate(male = ifelse(sex == "Мъж",1,0),
days_to_death = as.numeric(days_to_death),
days_hospital = as.numeric(days_hospital))
View(table_1)
View(table_1)
#| echo: false
table_1 = dat_seq %>%
select(-c(weeks, week)) %>%
mutate(sempl = "sample",
id = as.character(id)) %>%
right_join(dat_all) %>%
mutate(sempl = if_else(is.na(sempl),"general_pop","sample")) %>%
select(days_hospital,days_to_death,sex,sempl,age) %>%
mutate(male = ifelse(sex == "Мъж",1,0),
days_to_death = as.numeric(days_to_death),
days_hospital = as.numeric(days_hospital)) %>%
select(-sex) %>%
tbl_summary(
by = sempl,
statistic = list(age ~ "{mean} ({sd})",
all_categorical() ~ "{n} / {N} ({p}%)"),
missing = "no"
) %>%
add_difference()
table_1
#| echo: false
table_1 = dat_seq %>%
select(-c(weeks, week)) %>%
mutate(sempl = "sample",
id = as.character(id)) %>%
right_join(dat_all) %>%
mutate(sempl = if_else(is.na(sempl),"general_pop","sample")) %>%
select(days_hospital,days_to_death,sex,sempl,age) %>%
mutate(male = ifelse(sex == "Мъж",1,0),
days_to_death = as.numeric(days_to_death),
days_hospital = as.numeric(days_hospital)) %>%
select(-sex) %>%
tbl_summary(
by = sempl,
statistic = list(age ~ "{mean} ({sd})",
all_categorical() ~ "{n} / {N} ({p}%)"),
missing = "no"
) %>%
add_difference() %>%
as_flex_table()
table_1
#| echo: false
#| warning: false
library(tidyverse)
library(lubridate)
library(patchwork)
library(gtsummary)
library(easystats)
library(flextable)
library(scales)
library(rstatix)
set_flextable_defaults(fonts_ignore=TRUE)
setwd("~/MEGAsync/2022-09-15_atanasova_bam")
#| echo: false
#| warnings: false
#| fig-pos: 'H'
table_1
library(tidyverse)
library(here)
library(readr)
library(lubridate)
setwd("~/MEGA/MEGAsync/2022-09-15_atanasova_bam")
setwd("~/MEGAsync/2022-09-15_atanasova_bam")
# data cleaning
# loading libraries
library(tidyverse)
library(here)
library(readr)
library(lubridate)
setwd("~/MEGAsync/2022-09-15_atanasova_bam")
# functions
calc_age <- function(birthDate, refDate) {
require(lubridate)
period <- as.period(interval(birthDate, refDate),
unit = "year")
period$year
}
calc_days<- function(day_1, day_2) {
require(lubridate)
period <- as.period(interval(day_1, day_2),
unit = "day")
period$day
}
# Данни
## Секвенирани пациенти
sec_dat <- read_csv("sec_data.csv",
col_types = cols(birth_date = col_date(format = "%Y-%m-%d"))) %>%
mutate_if(is.character, str_trim) %>%
mutate(variant_type = case_when(
str_detect(code, "Alpha") ~ "Aplha",
str_detect(code, "Delta") ~ "Delta",
TRUE ~ "Omicron"))
# Всички пациенти
dat_all <- read_csv("all_patients.csv",
col_types = cols(birth_date = col_date(format = "%Y-%m-%d"),
admit_day = col_date(format = "%Y-%m-%d"),
disch_day = col_date(format = "%Y-%m-%d"),
death_date = col_date(format = "%Y-%m-%d"))) %>%
select(-c(type, exam_day, date_pcr_results)) %>%
distinct() %>%
mutate_if(is.character, str_trim) %>%
mutate(age = calc_age(birth_date, admit_day),
days_hospital = calc_days(admit_day,disch_day),
days_to_death = calc_days(admit_day, death_date),
week = week(admit_day),
year = year(admit_day),
week_year = str_c(week, year, sep = " ", collapse = NULL),
wday = wday(admit_day, label = TRUE),
weekend = if_else(wday %in% c("съб", "нед"), "weekedn", "weekday")) %>%
filter(between(admit_day, as.Date('2021-07-01'), as.Date('2022-05-09')))
write_rds(all_patients, "all_patients.rds")
## Синхронизирани секвенирани пациенти
dat = sec_dat %>%
left_join(select(dat_all, -c(birth_date, sex)))
write_rds(dat, "dat.rds")
write_rds(dat, "dat.csv")
#| include: false
#| warning: false
library(ggthemes)
library(tidyverse)
library(lubridate)
library(patchwork)
library(gtsummary)
library(easystats)
library(flextable)
library(scales)
library(rstatix)
ggplot2::theme_set(ggthemes::theme_tufte(base_size = 16, ticks =FALSE))
install.packages(c("bife", "censReg", "clubSandwich", "collapse", "correlation", "datawizard", "DT", "effectsize", "EGAnet", "emmeans", "estimability", "evaluate", "flextable", "gbm", "gert", "ggraph", "globals", "gmp", "googlesheets4", "graphlayouts", "Hmisc", "htmltools", "insight", "JM", "marginaleffects", "multcomp", "nleqslv", "parameters", "performance", "rbibutils", "rlang", "rmcorr", "robustlmm", "rockchalk", "rsample", "see", "semPlot", "statmod", "xfun"))
library(heaven)
install.packages("haven")       # Install & load haven
library("haven")
# data cleaning
# loading libraries
library(tidyverse)
library(here)
library(readr)
library(lubridate)
library(heaven)
# data cleaning
# loading libraries
library(tidyverse)
library(here)
library(readr)
library(lubridate)
library(haven)
setwd("~/MEGAsync/2022-09-15_atanasova_bam")
# functions
calc_age <- function(birthDate, refDate) {
require(lubridate)
period <- as.period(interval(birthDate, refDate),
unit = "year")
period$year
}
calc_days<- function(day_1, day_2) {
require(lubridate)
period <- as.period(interval(day_1, day_2),
unit = "day")
period$day
}
# Данни
## Секвенирани пациенти
sec_dat <- read_csv("sec_data.csv",
col_types = cols(birth_date = col_date(format = "%Y-%m-%d"))) %>%
mutate_if(is.character, str_trim) %>%
mutate(variant_type = case_when(
str_detect(code, "Alpha") ~ "Aplha",
str_detect(code, "Delta") ~ "Delta",
TRUE ~ "Omicron"))
# Всички пациенти
dat_all <- read_csv("all_patients.csv",
col_types = cols(birth_date = col_date(format = "%Y-%m-%d"),
admit_day = col_date(format = "%Y-%m-%d"),
disch_day = col_date(format = "%Y-%m-%d"),
death_date = col_date(format = "%Y-%m-%d"))) %>%
select(-c(type, exam_day, date_pcr_results)) %>%
distinct() %>%
mutate_if(is.character, str_trim) %>%
mutate(age = calc_age(birth_date, admit_day),
days_hospital = calc_days(admit_day,disch_day),
days_to_death = calc_days(admit_day, death_date),
week = week(admit_day),
year = year(admit_day),
week_year = str_c(week, year, sep = " ", collapse = NULL),
wday = wday(admit_day, label = TRUE),
weekend = if_else(wday %in% c("съб", "нед"), "weekedn", "weekday")) %>%
filter(between(admit_day, as.Date('2021-07-01'), as.Date('2022-05-09')))
write_rds(all_patients, "all_patients.rds")
## Синхронизирани секвенирани пациенти
dat = sec_dat %>%
left_join(select(dat_all, -c(birth_date, sex)))
write_rds(dat, "dat.rds")
write.csv(dat, "dat.csv")
